# file opened: nc.asm
  1   0000              ;None Commander - приложение для OS GMX
  2   0000                 device ZXSPECTRUM128
  3   0000              	include "../os_defs.asm"
# file opened: ../os_defs.asm
  1+  0000              ;Список всех вызовов (функций) ОС GMX
  2+  0000
  3+  0000              ;Включить в свой код (в начале файла):
  4+  0000              	; include os_defs.asm
  5+  0000
  6+  0000              ;Использовать только имена функций, коды могут поменяться
  7+  0000
  8+  0000              ;например:
  9+  0000              	; org PROGSTART
 10+  0000              	; ../include os_defs.asm
 11+  0000              	; ld hl,text
 12+  0000              	; OS_PRINTZ ;печать	до кода 0
 13+  0000
 14+  0000              ;сохранность регистров не гарантируется
 15+  0000              ;на выходе обычно (но не всегда) CY=1 = ошибка
 16+  0000
 17+  0000              PROGSTART equ #8000 ;адрес старта приложений
 18+  0000
 19+  0000
 20+  0000              ;короткие вызовы (именные RST) -------------------------
 21+  0000
 22+  0000              ;печать символа в консоль (ускоренная)
 23+  0000              	MACRO OS_PRINT_CHARF ;a=char
 24+  0000 ~            	rst #10
 25+  0000              	ENDM
 26+  0000
 27+  0000
 28+  0000              ;передача управления ОС до следующего прерывания (когда придёт очередь процесса в следующий раз);
 29+  0000              ;все регистры сохраняются
 30+  0000              ;рекомендуется использовать вместо обычного halt
 31+  0000              	MACRO OS_WAIT
 32+  0000 ~            	rst #18
 33+  0000              	ENDM
 34+  0000
 35+  0000              	; MACRO OS_
 36+  0000              	; rst #28
 37+  0000              	; ENDM
 38+  0000
 39+  0000              	; MACRO OS_
 40+  0000              	; rst #30
 41+  0000              	; ENDM
 42+  0000
 43+  0000
 44+  0000
 45+  0000              ;вызовы через единую точку входа RST #20 ----------------
 46+  0000
 47+  0000              ;вывод в консоль --------------------
 48+  0000
 49+  0000              ;очистить консоль
 50+  0000              	macro OS_CLS ;clear visible area of terminal
 51+  0000 ~                ld c,#00
 52+  0000 ~                rst #20
 53+  0000                  endm
 54+  0000
 55+  0000              ;установить позицию курсора в консоли
 56+  0000                  macro OS_SET_XY ;de=yx ;SET CURSOR POSITION
 57+  0000 ~                ld c,#01
 58+  0000 ~                rst #20
 59+  0000                  endm
 60+  0000
 61+  0000              ;печать символа в консоль
 62+  0000                  macro OS_PRINT_CHAR ;a=char
 63+  0000 ~                ld c,#02
 64+  0000 ~                rst #20
 65+  0000                  endm
 66+  0000
 67+  0000              ;заполнение строки одним символом
 68+  0000                  macro OS_FILL_LINE ;; H - line ; A - char
 69+  0000 ~                ld c,#03
 70+  0000 ~                rst #20
 71+  0000                  endm
 72+  0000
 73+  0000              ;покрасить строку цветом
 74+  0000                  macro OS_PAINT_LINE ;a - line, b - color
 75+  0000 ~                ld c,#04
 76+  0000 ~                rst #20
 77+  0000                  endm
 78+  0000
 79+  0000
 80+  0000                  ; macro OS_ ;
 81+  0000                  ; ld c,#05
 82+  0000                  ; rst #20
 83+  0000                  ; endm
 84+  0000
 85+  0000              ;установить цвет текста в консоли;
 86+  0000                  macro OS_SET_COLOR ;a = color, b = color 2 (highlight)
 87+  0000 ~                ld c,#06
 88+  0000 ~                rst #20
 89+  0000                  endm
 90+  0000
 91+  0000                  ; macro OS_ ;
 92+  0000                  ; ld c,#07
 93+  0000                  ; rst #20
 94+  0000                  ; endm
 95+  0000
 96+  0000                  ; macro OS_ ;
 97+  0000                  ; ld c,#08
 98+  0000                  ; rst #20
 99+  0000                  ; endm
100+  0000
101+  0000
102+  0000
103+  0000              ;печать в консоль до кода 0
104+  0000                  macro OS_PRINTZ ;hl=text ;PRINT to 0
105+  0000 ~                ld c,#09
106+  0000 ~                rst #20
107+  0000                  endm
108+  0000
109+  0000
110+  0000              ;прочитать байт из порта uart
111+  0000              ;вх:
112+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart или нет данных для приёма
113+  0000              ;вых: A - считанный байт
114+  0000                  macro OS_UART_READ
115+  0000 ~                ld c,#0a
116+  0000 ~                rst #20
117+  0000                  endm
118+  0000
119+  0000              ;записать байт в порт uart
120+  0000              ;вх: A -байт
121+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart
122+  0000                  macro OS_UART_WRITE
123+  0000 ~                ld c,#0b
124+  0000 ~                rst #20
125+  0000                  endm
126+  0000
127+  0000              ;закрыть соединение ESP
128+  0000              ;вх:
129+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart
130+  0000                  macro OS_ESP_CLOSE
131+  0000 ~                ld c,#0c
132+  0000 ~                rst #20
133+  0000                  endm
134+  0000
135+  0000              ;установить соединение ESP (CIPSTART);
136+  0000              ;вх: a - тип соединения 0-tcp, 1-udp, 2-ssl; 3-прямое соединение с портом; hl - строка адрес, de - строка порт
137+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart
138+  0000              ;вых: ix - адрес в таблице соединений (ix+2 - флаг открытия =1 - открыто, 255 - ошибка);
139+  0000                  macro OS_ESP_OPEN
140+  0000 ~                ld c,#0d
141+  0000 ~                rst #20
142+  0000                  endm
143+  0000
144+  0000              ;послать запрос ESP (CIPSEND);
145+  0000              ;вх: hl - адрес данных, de - длина данных
146+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart
147+  0000              ;вых: ix - адрес в таблице соединений (ix+4 - флаг =1 - отправлено, 255 - ошибка)
148+  0000                  macro OS_ESP_SEND
149+  0000 ~                ld c,#0e
150+  0000 ~                rst #20
151+  0000                  endm
152+  0000
153+  0000              ;получить пакет ESP (+IPD);
154+  0000              ;вх: hl - адрес для данных
155+  0000              ;вых: CY=0 - OK; CY=1 - занято другим процессом или нет uart
156+  0000              ;вых: ix - адрес в таблице соединений (ix+6 - флаг =1 - принято, 255 - ошибка)
157+  0000                  macro OS_ESP_GET
158+  0000 ~                ld c,#0f
159+  0000 ~                rst #20
160+  0000                  endm
161+  0000
162+  0000              ;ввод с консоли ----------------------
163+  0000
164+  0000              ;получить код нажатой клавиши
165+  0000                  macro OS_GET_CHAR ;read char from stdin (out: A=char, 255-no char)
166+  0000 ~                ld c,#10
167+  0000 ~                rst #20
168+  0000                  endm
169+  0000
170+  0000
171+  0000              ;процессы ----------------------------
172+  0000
173+  0000              ;запустить процесс
174+  0000              ;вх: hl - имя файла (заканчивается на 0)
175+  0000                  macro OS_PROC_RUN ;
176+  0000 ~                ld c,#11
177+  0000 ~                rst #20
178+  0000                  endm
179+  0000
180+  0000              ;установить фокус
181+  0000              ;вх: a - id процесса
182+  0000                  macro OS_PROC_SET_FOCUS ;
183+  0000 ~                ld c,#12
184+  0000 ~                rst #20
185+  0000                  endm
186+  0000
187+  0000              ;закрыть процесс
188+  0000              ;вх: A - ID процесса. Если A=0, закрыть текущий (себя)
189+  0000              ;останавливается процесс и освобождаются все его страницы памяти, файлы, соединения
190+  0000                  macro OS_PROC_CLOSE ;
191+  0000 ~                ld c,#13
192+  0000 ~                rst #20
193+  0000                  endm
194+  0000
195+  0000
196+  0000              ;прерывания --------------------------
197+  0000
198+  0000              ;установка адреса обработчика прерываний процесса;
199+  0000                  ; macro OS_SET_INTER ;(HL - address, A = 1 - On, A = 0 - Off)
200+  0000                  ; ld c,#14
201+  0000                  ; rst #20
202+  0000                  ; endm
203+  0000
204+  0000
205+  0000              ;плеер AY ----------------------------
206+  0000
207+  0000              ;инициализация плеера AY;
208+  0000                  macro OS_VTPL_INIT ;(HL - address music)
209+  0000 ~                ld c,#15
210+  0000 ~                rst #20
211+  0000                  endm
212+  0000
213+  0000              ;запустить плеер AY (система будет сама вызывать его каждое прерывание);
214+  0000                  macro OS_VTPL_PLAY ;()
215+  0000 ~                ld c,#16
216+  0000 ~                rst #20
217+  0000                  endm
218+  0000
219+  0000              ;заглушить плеер AY;
220+  0000                  macro OS_VTPL_MUTE ;()
221+  0000 ~                ld c,#17
222+  0000 ~                rst #20
223+  0000                  endm
224+  0000
225+  0000              ;получить значение переменной плеера;
226+  0000                  macro OS_GET_VTPL_SETUP ;(out: HL - setup address)
227+  0000 ~                ld c,#18
228+  0000 ~                rst #20
229+  0000                  endm
230+  0000
231+  0000
232+  0000              ;прочие ------------------------------
233+  0000
234+  0000
235+  0000              ;скопировать данные из страницы в страницу
236+  0000              ;вх: hl - откуда (абсолютный адрес 0-ffff); de - куда; ix - длина; a - страница слот2; b - страница слот3;
237+  0000                  macro OS_RAM_COPY
238+  0000 ~                ld c,#19
239+  0000 ~                rst #20
240+  0000                  endm
241+  0000
242+  0000              ;получить дополнительную страницу памяти;
243+  0000                  macro OS_GET_PAGE ;(out A - number page)
244+  0000 ~                ld c,#1a
245+  0000 ~                rst #20
246+  0000                  endm
247+  0000
248+  0000              ;включить страницу в слот 2 (#8000); предварительно зарезервировать страницу OS_GET_PAGE
249+  0000                  macro OS_SET_PAGE_SLOT2 ;(A - page number)
250+  0000 ~                ld c,#1b
251+  0000 ~                rst #20
252+  0000                  endm
253+  0000
254+  0000              ;включить страницу в слот 3 (#C000); предварительно зарезервировать страницу OS_GET_PAGE
255+  0000                  macro OS_SET_PAGE_SLOT3 ;(A - page number)
256+  0000 ~                ld c,#1c
257+  0000 ~                rst #20
258+  0000                  endm
259+  0000
260+  0000              ;включить экран N;
261+  0000              ;вх: A - номер экрана (5, 7, #39, #3a; 0 = текстовый)
262+  0000              ;переключать может только приложение в фокусе
263+  0000              ;если режим не текстовый, то приложение работает только когда в фокусе. Иначе временно останавливается.
264+  0000              ;при переключении процессов сохраняется только экран #39
265+  0000                  macro OS_SET_SCREEN ;
266+  0000 ~                ld c,#1d
267+  0000 ~                rst #20
268+  0000                  endm
269+  0000
270+  0000
271+  0000              ;получить номера страниц процесса;
272+  0000              ;вх:
273+  0000              ;вых: b, c - страницы в слотах 2, 3
274+  0000                  macro OS_GET_MAIN_PAGES ;
275+  0000 ~                ld c,#1e
276+  0000 ~                rst #20
277+  0000                  endm
278+  0000
279+  0000              ;получить значение системного таймера
280+  0000                  macro OS_GET_TIMER ;(out: HL, DE - timer)
281+  0000 ~                ld c,#1F
282+  0000 ~                rst #20
283+  0000                  endm
284+  0000
285+  0000
286+  0000
287+  0000                  ; macro OS_ ;
288+  0000                  ; ld c,#20
289+  0000                  ; rst #20
290+  0000                  ; endm
291+  0000
292+  0000
293+  0000              ;дисковые операции -------------------
294+  0000
295+  0000              ; менять напрямую что-то в таблице fcb из приложения не рекомендуется, только для чтения
296+  0000
297+  0000              ; fcbFAT (из руководства к монитору)
298+  0000              ; формат fcb для работы с FAT
299+  0000
300+  0000              ; +#00 8 имя файла
301+  0000              ; +#08 3 расширение файла
302+  0000              ; +#0B 1 атрибуты файла
303+  0000              ; +#0C 4 номер первого кластера файла/каталога
304+  0000              ; +#10 4 номер первого кластера каталога с этим файлом/каталогом
305+  0000              ; +#14 4 размер файла/каталога в байтах
306+  0000              ; +#18 4 указатель в файле
307+  0000              ; +#1C 1 для внутренних нужд
308+  0000              ; +#1D 1 для внутренних нужд
309+  0000              ; +#1E 1 резерв
310+  0000              ; +#1F 1 номер винчестера и раздела на нем
311+  0000              	; 1-0,nn номер раздела
312+  0000              	; 3-2,=00/01/10 HDD master/HDD slave/SD
313+  0000              	    ; значение %11 недопустимо
314+  0000
315+  0000              ;открыть файл для чтения или записи
316+  0000                  macro OS_FILE_OPEN ;HL - File name (out: A - id file, bc, de - size, IX - fcb)
317+  0000 ~                ld c,#21
318+  0000 ~                rst #20
319+  0000                  endm
320+  0000
321+  0000              ;создать файл
322+  0000                  macro OS_FILE_CREATE ;HL - File name  (out: A - id file, IX - fcb)
323+  0000 ~                ld c,#22
324+  0000 ~                rst #20
325+  0000                  endm
326+  0000
327+  0000              ;прочитать из файла
328+  0000                  macro OS_FILE_READ ;HL - address, A - id file, DE - length (out: bc - size readed)
329+  0000 ~                ld c,#23
330+  0000 ~                rst #20
331+  0000                  endm
332+  0000
333+  0000              ;записать в файл
334+  0000                  macro OS_FILE_WRITE ;HL - address, A - id file, DE - length (out: bc - size writed)
335+  0000 ~                ld c,#24
336+  0000 ~                rst #20
337+  0000                  endm
338+  0000
339+  0000              ;закрыть файл
340+  0000                  macro OS_FILE_CLOSE ;A - id file
341+  0000 ~                ld c,#25
342+  0000 ~                rst #20
343+  0000                  endm
344+  0000
345+  0000              ;чтение секторов текущего каталога
346+  0000              ; вх:
347+  0000                   ; hl - буфер для чтения
348+  0000                   ; de - относительный номер первого сектора каталога для чтения [0..nn]
349+  0000                   ; b - максимальное количество секторов для чтения
350+  0000              ; вых: cy=1, если были ошибки, код ошибки возвращается в аккумуляторе
351+  0000                     ; a=errRWnum
352+  0000                     ; a=errInvalidPart
353+  0000                     ; a=errFileEmpty
354+  0000                   ; cy=0, a=errEoF - каталог закончился
355+  0000                     ; hl - следующий адрес в буфере
356+  0000                     ; de - номер первого непрочитанного сектора
357+  0000                     ; b - не прочитано секторов
358+  0000                   ; cy=0 - считано успешно
359+  0000                     ; hl - следующий адрес в буфере
360+  0000                     ; de - номер первого непрочитанного сектора
361+  0000                     ; b=#00
362+  0000                  macro OS_DIR_READ ;
363+  0000 ~                ld c,#26
364+  0000 ~                rst #20
365+  0000                  endm
366+  0000
367+  0000              ;вход в каталог/выход в родительский каталог
368+  0000              	; Если путь не указан производится только настройка переменных драйвера,
369+  0000              	; при этом если передан дескриптор файла, текущий каталог не изменится)
370+  0000              	; Если пусть указан, в конец пути добавится название каталога (если это
371+  0000              	; переход в родительский, последнее имя в пути удалится).
372+  0000              	; Если передан дескриптор файла, текущий каталог не изменится, к пути
373+  0000              	; добавится имя файла
374+  0000              ; вх:
375+  0000                   ; hl - адрес пути (=#0000 - путь отсутствует)
376+  0000                   ; de - адрес дескриптора директории/файла
377+  0000              ; вых: a - если путь был указан, новая длина пути
378+  0000                  macro OS_DIR_OPEN ;
379+  0000 ~                ld c,#27
380+  0000 ~                rst #20
381+  0000                  endm
382+  0000
383+  0000              ;установка/чтение указателя в файле (Переменная +#18-#1b fcb)
384+  0000              ;проверки на допустимость значений не производится
385+  0000              ;вх: CY = 1 - установка; CY = 0 - чтение
386+  0000              ;вх: A - id файла
387+  0000              ;вх: de, hl - значения старшие быйты, младшие
388+  0000              ;вых: de, hl - значения старшие быйты, младшие
389+  0000                  macro OS_FILE_POSITION ;
390+  0000 ~                ld c,#28
391+  0000 ~                rst #20
392+  0000                  endm
393+  0000
394+  0000                  ; macro OS_ ;
395+  0000                  ; ld c,#29
396+  0000                  ; rst #20
397+  0000                  ; endm
398+  0000
399+  0000
# file closed: ../os_defs.asm
  4   0000              	org PROGSTART
  5   8000
  6   8000              start_nc
  7   8000 21 5B 88     	ld hl,msg_title_nc ;имя приложения
  8   8003              	OS_PRINTZ ;печать
  8   8003 0E 09       >    ld c,#09
  8   8005 E7          >    rst #20
  9   8006
 10   8006
 11   8006              	;узнать свои страницы
 12   8006              	OS_GET_MAIN_PAGES
 12   8006 0E 1E       >    ld c,#1e
 12   8008 E7          >    rst #20
 13   8009 38 09        	jr c,get_page_error
 14   800B
 15   800B ED 43 A8 87  	ld (page_main),bc
 16   800F
 17   800F
 18   800F              	OS_GET_PAGE ;получить лишнюю страницу
 18   800F 0E 1A       >    ld c,#1a
 18   8011 E7          >    rst #20
 19   8012 30 0C        	jr nc,get_page_ok
 20   8014              get_page_error
 21   8014 21 48 88     	ld hl,msg_mem_err ;нет памяти
 22   8017              	OS_PRINTZ ;печать
 22   8017 0E 09       >    ld c,#09
 22   8019 E7          >    rst #20
 23   801A
 24   801A CD 76 80     	call delay
 25   801D C3 18 81     	jp exit
 26   8020
 27   8020              get_page_ok
 28   8020 32 A7 87     	ld (page_ext01),a ;запомнить
 29   8023
 30   8023
 31   8023
 32   8023              start_nc_warm ;тёплый старт
 33   8023
 34   8023              	;очистка буфера
 35   8023 CD 7C 80     	call clear_buf
 36   8026
 37   8026              	;загрузка каталога
 38   8026 21 00 C0     	ld hl,buffer_cat ;куда
 39   8029 11 00 00     	ld de,0 ;начиная с 0 сектора
 40   802C 06 20        	ld b,32 ; секторов
 41   802E              	OS_DIR_READ
 41   802E 0E 26       >    ld c,#26
 41   8030 E7          >    rst #20
 42   8031
 43   8031 21 00 00     	ld hl,0 ;обнулить переменные
 44   8034 22 A3 87     	ld (file_r_num_cur),hl
 45   8037 22 87 85     	ld (file_r_all),hl
 46   803A
 47   803A CD B4 81     	call format_dir
 48   803D
 49   803D 3E 0F        	ld a,color_backgr
 50   803F 06 0C        	ld b,#c
 51   8041              	OS_SET_COLOR
 51   8041 0E 06       >    ld c,#06
 51   8043 E7          >    rst #20
 52   8044
 53   8044 CD 63 82     	call print_rect_r ;рамка
 54   8047 CD 30 81     	call print_panel_r
 55   804A CD 98 82     	call print_menu_main
 56   804D
 57   804D 11 00 01     	ld de,#0100
 58   8050              	OS_SET_XY
 58   8050 0E 01       >    ld c,#01
 58   8052 E7          >    rst #20
 59   8053
 60   8053
 61   8053
 62   8053              nc_wait
 63   8053              	OS_WAIT ;ждать прерывание
 63   8053 DF          >	rst #18
 64   8054
 65   8054              	OS_GET_CHAR ;клавиша
 65   8054 0E 10       >    ld c,#10
 65   8056 E7          >    rst #20
 66   8057 32 A5 87     	ld (key_pressed),a ;запомнить
 67   805A FE 0D        	cp 13
 68   805C CA 93 80     	jp z,key_enter ;
 69   805F FE 0A        	cp 10 ;вниз
 70   8061 CA DC 80     	jp z,key_down
 71   8064 FE 0B        	cp 11 ;вверх
 72   8066 CA FF 80     	jp z,key_up
 73   8069 FE 18        	cp 24 ;break
 74   806B CA 18 81     	jp z,exit
 75   806E FE 33        	cp "3" ;просмотр файла
 76   8070 CA AC 82     	jp z,view_file
 77   8073
 78   8073 C3 53 80     	jp nc_wait ;на цикл ожидания
 79   8076
 80   8076
 81   8076              delay ;задержка
 82   8076 06 96        	ld b,50*3 ;
 83   8078              delay1
 84   8078              	OS_WAIT
 84   8078 DF          >	rst #18
 85   8079 10 FD        	djnz delay1
 86   807B C9           	ret
 87   807C
 88   807C
 89   807C              clear_buf
 90   807C 21 00 C0     	ld hl,buffer_cat
 91   807F 11 01 C0     	ld de,buffer_cat+1
 92   8082 01 FF 3F     	ld bc,#4000-1
 93   8085 36 00        	ld (hl),0
 94   8087 ED B0        	ldir
 95   8089 C9           	ret
 96   808A
 97   808A
 98   808A
 99   808A
100   808A              release_key ;ждать отпускания клавиши
101   808A              	OS_WAIT
101   808A DF          >	rst #18
102   808B              	OS_GET_CHAR
102   808B 0E 10       >    ld c,#10
102   808D E7          >    rst #20
103   808E FE FF        	cp 255
104   8090 20 F8        	jr nz,release_key
105   8092 C9           	ret
106   8093
107   8093
108   8093              key_enter
109   8093              	;нажата Enter
110   8093 2A 87 85     	ld hl,(file_r_all)
111   8096 7D           	ld a,l
112   8097 B4           	or h
113   8098 CA BC 80     	jp z,key_enter_ex ;защита
114   809B CD CC 80     	call calc_deskr
115   809E DD 7E 0B     	ld a,(ix+#0b)
116   80A1 FE 10        	cp #10 ;признак каталога
117   80A3 28 1A        	jr z,key_enter_dir
118   80A5
119   80A5              	;проверка расширения ;APG
120   80A5 CD 1C 81     	call check_apg
121   80A8 C2 BC 80     	jp nz,key_enter_ex
122   80AB              	;тут запуск приложения
123   80AB CD 2E 82     	call format_name
124   80AE
125   80AE 21 89 85     	ld hl,file_name_cur		;строка с именем
126   80B1              	OS_PROC_RUN ;запустить прогу
126   80B1 0E 11       >    ld c,#11
126   80B3 E7          >    rst #20
127   80B4              	;обработка ошибки
128   80B4 38 06        	jr c,key_enter_ex
129   80B6
130   80B6 DD 7E 00     	ld a,(ix)
131   80B9              	OS_PROC_SET_FOCUS ;на передний план
131   80B9 0E 12       >    ld c,#12
131   80BB E7          >    rst #20
132   80BC
133   80BC              key_enter_ex
134   80BC C3 53 80     	jp nc_wait
135   80BF
136   80BF              key_enter_dir
137   80BF              	;тут открытие папки
138   80BF
139   80BF              	;call format_name_dir
140   80BF EB           	ex de,hl ;de - дескриптор для открытия
141   80C0 21 89 86     	ld hl,dir_name_cur
142   80C3              	OS_DIR_OPEN
142   80C3 0E 27       >    ld c,#27
142   80C5 E7          >    rst #20
143   80C6 38 F4        	jr c,key_enter_ex ;если ошибка, ничего не делаем
144   80C8
145   80C8 E1           	pop hl ;отменить возврат
146   80C9 C3 23 80     	jp start_nc_warm ;перезагрузить папку
147   80CC
148   80CC
149   80CC              ; format_name_dir
150   80CC              	; push hl
151   80CC              	; ld hl,file_name_cur
152   80CC              	; ld de,file_name_cur+1 ;почистить
153   80CC              	; ld bc,256-1
154   80CC              	; ld (hl),0
155   80CC              	; ldir
156   80CC
157   80CC              	; pop hl
158   80CC
159   80CC              	; ld de,file_name_cur ;куда
160   80CC              	; ld bc,#08ff
161   80CC              ; format_name_dir_cl
162   80CC              	; ld a,(hl)
163   80CC              	; cp " "+1
164   80CC              	; jr c,format_name_dir_skip
165   80CC              	; ldi
166   80CC              	; djnz format_name_dir_cl
167   80CC              ; format_name_dir_skip
168   80CC              	; ld a,'/'
169   80CC              	; ld (de),a
170   80CC              	; ret
171   80CC
172   80CC              calc_deskr ;вычислить дескриптор текущего элемента справа
173   80CC 11 00 C0     	ld de,buffer_cat
174   80CF 2A A3 87     	ld hl,(file_r_num_cur)
175   80D2 29           	add hl,hl ;*2
176   80D3 29           	add hl,hl ;*4
177   80D4 29           	add hl,hl ;*8
178   80D5 29           	add hl,hl ;*16
179   80D6 29           	add hl,hl ;*32
180   80D7 19           	add hl,de
181   80D8 E5           	push hl
182   80D9 DD E1        	pop ix ;указатель на файл в каталоге
183   80DB C9           	ret
184   80DC
185   80DC
186   80DC              key_down
187   80DC 2A 87 85     	ld hl,(file_r_all)
188   80DF 7D           	ld a,l
189   80E0 B4           	or h
190   80E1 CA FC 80     	jp z,key_down_ex ;защита
191   80E4 2A A3 87     	ld hl,(file_r_num_cur)
192   80E7 23           	inc hl
193   80E8 ED 4B 87 85  	ld bc,(file_r_all)
194   80EC              	;если не больше чем всего
195   80EC E5           	push hl
196   80ED A7           	and a
197   80EE ED 42        	sbc hl,bc
198   80F0 E1           	pop hl
199   80F1 30 06        	jr nc,key_down_skip
200   80F3 22 A3 87     	ld (file_r_num_cur),hl
201   80F6 CD 30 81     	call print_panel_r ;обновить каталог
202   80F9              key_down_skip
203   80F9 3A A5 87     	ld a,(key_pressed)
204   80FC              key_down_ex
205   80FC C3 53 80     	jp nc_wait
206   80FF
207   80FF
208   80FF
209   80FF              key_up
210   80FF 2A 87 85     	ld hl,(file_r_all)
211   8102 7D           	ld a,l
212   8103 B4           	or h
213   8104 CA 15 81     	jp z,key_up_ex ;защита
214   8107 2A A3 87     	ld hl,(file_r_num_cur)
215   810A 7D           	ld a,l
216   810B B4           	or h
217   810C 28 07        	jr z,key_up_skip
218   810E 2B           	dec hl
219   810F 22 A3 87     	ld (file_r_num_cur),hl
220   8112 CD 30 81     	call print_panel_r ;обновить каталог
221   8115              key_up_skip
222   8115
223   8115              key_up_ex
224   8115 C3 53 80     	jp nc_wait
225   8118
226   8118
227   8118              exit ;выход в DOS
228   8118 AF           	xor a
229   8119              	OS_PROC_CLOSE
229   8119 0E 13       >    ld c,#13
229   811B E7          >    rst #20
230   811C
231   811C
232   811C
233   811C              check_apg ;проверка на расширение APG
234   811C DD 7E 08     	ld a,(ix+8)
235   811F FE 41        	cp "A"
236   8121 C0           	ret nz
237   8122 DD 7E 09     	ld a,(ix+9)
238   8125 FE 50        	cp "P"
239   8127 C0           	ret nz
240   8128 DD 7E 0A     	ld a,(ix+10)
241   812B FE 47        	cp "G"
242   812D C0           	ret nz
243   812E AF           	xor a ;равен
244   812F C9           	ret
245   8130
246   8130
247   8130
248   8130              print_panel_r ;печать правой панели
249   8130 DD 21 00 C0  	ld ix,buffer_cat
250   8134 11 29 01     	ld de,panel_r_xy ;координаты yx
251   8137 06 16        	ld b,panel_hight ;высота панели
252   8139 FD 21 00 00  	ld iy,0
253   813D              print_panel_r_cl ;цикл
254   813D C5           	push bc
255   813E D5           	push de ;xy
256   813F              	OS_SET_XY
256   813F 0E 01       >    ld c,#01
256   8141 E7          >    rst #20
257   8142 DD E5        	push ix ;адрес элемента
258   8144 E1           	pop hl
259   8145 7E           	ld a,(hl)
260   8146 B7           	or a ;конец каталога
261   8147 28 10        	jr z,print_panel_r_ex
262   8149 CD 5C 81     	call print_file_info
263   814C              print_panel_r_skip
264   814C D1           	pop de
265   814D 14           	inc d ;y++
266   814E FD 23        	inc iy ;текущий файл
267   8150 01 20 00     	ld bc,32 ;на другой элемент каталога
268   8153 DD 09        	add ix,bc
269   8155 C1           	pop bc
270   8156 10 E5        	djnz print_panel_r_cl
271   8158 C9           	ret
272   8159              print_panel_r_ex
273   8159 D1           	pop de
274   815A C1           	pop bc
275   815B
276   815B              	;здесь почистить остаток каталога
277   815B C9           	ret
278   815C
279   815C
280   815C
281   815C              print_file_info ;печать строчки о файле
282   815C 11 89 87     	ld de,file_info_string ;скопировать
283   815F 01 0B 00     	ld bc,file_info_lenght
284   8162 ED B0        	ldir
285   8164
286   8164 CD 73 81     	call get_color_item
287   8167
288   8167 06 0C        	ld b,#c
289   8169              	OS_SET_COLOR
289   8169 0E 06       >    ld c,#06
289   816B E7          >    rst #20
290   816C 21 89 87     	ld hl,file_info_string
291   816F              	OS_PRINTZ
291   816F 0E 09       >    ld c,#09
291   8171 E7          >    rst #20
292   8172 C9           	ret
293   8173
294   8173
295   8173
296   8173              get_color_item ;получить цвет элемента
297   8173              ;вх: IX - адрес в каталоге, IY - порядковый номер (0-511)
298   8173              ;вых: A - цвет
299   8173 ED 4B A3 87  	ld bc,(file_r_num_cur) ;позиция курсора справа
300   8177 FD E5        	push iy
301   8179 E1           	pop hl
302   817A A7           	and a
303   817B ED 42        	sbc hl,bc ;сравнить
304   817D 28 11        	jr z,get_color_item_no_cursor
305   817F              	;цвета курсора
306   817F 3E 0E        	ld a,color_dir ;простая
307   8181 32 A7 81     	ld (get_color_item_dir+1),a
308   8184 3E 0C        	ld a,color_apg ;простая
309   8186 32 AF 81     	ld (get_color_item_apg+1),a
310   8189 3E 0F        	ld a,color_backgr ;простая
311   818B 32 B2 81     	ld (get_color_item_backgr+1),a
312   818E 18 0F        	jr get_color_item_set
313   8190
314   8190              get_color_item_no_cursor
315   8190              	;цвета обычные
316   8190 3E 28        	ld a,color_dir_hi ;под курсором
317   8192 32 A7 81     	ld (get_color_item_dir+1),a
318   8195 3E 28        	ld a,color_apg_hi ;под курсором
319   8197 32 AF 81     	ld (get_color_item_apg+1),a
320   819A 3E 28        	ld a,color_backgr_hi ;под курсором
321   819C 32 B2 81     	ld (get_color_item_backgr+1),a
322   819F
323   819F              get_color_item_set
324   819F              	;задать цвет
325   819F DD 7E 0B     	ld a,(ix+#0b)
326   81A2 FE 10        	cp #10 ;признак каталога
327   81A4 20 03        	jr nz,get_color_item_no_dir
328   81A6              	;если папка
329   81A6              get_color_item_dir
330   81A6 3E 00        	ld a,0
331   81A8 C9           	ret
332   81A9
333   81A9              get_color_item_no_dir
334   81A9 CD 1C 81     	call check_apg ;расширение apg
335   81AC 20 03        	jr nz,get_color_item_no_apg
336   81AE              	;если приложение
337   81AE              get_color_item_apg
338   81AE 3E 00        	ld a,0
339   81B0 C9           	ret
340   81B1
341   81B1              get_color_item_no_apg
342   81B1              	;если обычный файл
343   81B1              get_color_item_backgr
344   81B1 3E 00        	ld a,0
345   81B3 C9           	ret
346   81B4
347   81B4
348   81B4
349   81B4              format_dir ;подготовить каталог, убрать лишнее
350   81B4              	; ld a,2
351   81B4              	; out (254),a
352   81B4 FD 21 00 00  	ld iy,0 ;счётчик файлов
353   81B8              	;найти конец каталога
354   81B8 21 00 C0     	ld hl,buffer_cat
355   81BB 7E           	ld a,(hl)
356   81BC B7           	or a
357   81BD C8           	ret z ;защита
358   81BE 01 20 00     	ld bc,32
359   81C1              format_dir_prep_cl
360   81C1 7E           	ld a,(hl)
361   81C2 B7           	or a
362   81C3 28 07        	jr z,format_dir_prep_ex
363   81C5 09           	add hl,bc
364   81C6 7C           	ld a,h
365   81C7 B7           	or a ;если вышли за границу
366   81C8 28 02        	jr z,format_dir_prep_ex
367   81CA 18 F5        	jr format_dir_prep_cl
368   81CC              format_dir_prep_ex
369   81CC 01 20 00     	ld bc,32
370   81CF A7           	and a
371   81D0 ED 42        	sbc hl,bc
372   81D2 22 2C 82     	ld (format_dir_top),hl ;конец каталога
373   81D5
374   81D5
375   81D5
376   81D5 DD 21 00 C0  	ld ix,buffer_cat
377   81D9              	;ld b,panel_hight ;высота панели
378   81D9              format_dir_cl ;цикл
379   81D9 DD 7E 00     	ld a,(ix)
380   81DC B7           	or a ;конец каталога
381   81DD 28 48        	jr z,format_dir_ex
382   81DF FE E5        	cp #e5 ;удалённый
383   81E1 28 27        	jr z,format_dir_skip
384   81E3 FE 05        	cp #05 ;удалённый
385   81E5 28 23        	jr z,format_dir_skip
386   81E7 DD 7E 0B     	ld a,(ix+#0b)
387   81EA FE 0F        	cp #0f ;длинный
388   81EC 28 1C        	jr z,format_dir_skip
389   81EE
390   81EE              	;проверка на папку "." (этот же каталог)
391   81EE DD 7E 00     	ld a,(ix+#00)
392   81F1 FE 2E        	cp "." ;
393   81F3 20 07        	jr nz,format_dir_add
394   81F5 DD 7E 01     	ld a,(ix+#01)
395   81F8 FE 20        	cp " " ;
396   81FA 28 0E        	jr z,format_dir_skip
397   81FC
398   81FC
399   81FC              format_dir_add
400   81FC FD 23        	inc iy ;++
401   81FE 01 20 00     	ld bc,32 ;на другой элемент каталога
402   8201 DD 09        	add ix,bc
403   8203 DD 7C        	ld a,ixh
404   8205 B7           	or a ;если вышли за границу
405   8206 28 1F        	jr z,format_dir_ex
406   8208 18 CF        	jr format_dir_cl
407   820A              format_dir_skip
408   820A              	;сдвинуть элементы вниз
409   820A DD E5        	push ix
410   820C DD E5        	push ix
411   820E E1           	pop hl
412   820F D1           	pop de ;куда
413   8210 2A 2C 82     	ld hl,(format_dir_top) ;0-32
414   8213 A7           	and a
415   8214 ED 52        	sbc hl,de
416   8216 44           	ld b,h
417   8217 4D           	ld c,l ;длина
418   8218 C5           	push bc
419   8219
420   8219 DD E5        	push ix
421   821B E1           	pop hl ;откуда
422   821C 01 20 00     	ld bc,32 ;на другой элемент каталога
423   821F 09           	add hl,bc ;откуда
424   8220
425   8220 C1           	pop bc
426   8221 ED B0        	ldir
427   8223
428   8223 AF           	xor a
429   8224 12           	ld (de),a ;очистить ненужный элемент
430   8225
431   8225 18 B2        	jr format_dir_cl
432   8227
433   8227              format_dir_ex
434   8227 FD 22 87 85  	ld (file_r_all),iy
435   822B              	;здесь почистить остаток каталога
436   822B              	; ld a,0
437   822B              	; out (254),a
438   822B C9           	ret
439   822C 00 00        format_dir_top	dw 0 ;временно конец гаталога
440   822E
441   822E
442   822E              format_name ;подогнать имя под стандарт filename.ext
443   822E              ;вх: HL - имя в каталоге
444   822E E5           	push hl
445   822F 21 89 85     	ld hl,file_name_cur
446   8232 11 8A 85     	ld de,file_name_cur+1 ;почистить
447   8235 01 FF 00     	ld bc,256-1
448   8238 36 00        	ld (hl),0
449   823A ED B0        	ldir
450   823C
451   823C E1           	pop hl
452   823D E5           	push hl
453   823E
454   823E 11 89 85     	ld de,file_name_cur ;куда
455   8241 01 FF 08     	ld bc,#08ff
456   8244              format_name_cl
457   8244 7E           	ld a,(hl)
458   8245 FE 21        	cp " "+1
459   8247 38 04        	jr c,format_name_skip
460   8249 ED A0        	ldi
461   824B 10 F7        	djnz format_name_cl
462   824D              format_name_skip
463   824D 3E 2E        	ld a,"."
464   824F 12           	ld (de),a
465   8250
466   8250 13           	inc de
467   8251 E1           	pop hl
468   8252 01 08 00     	ld bc,8 ;перейти на расширение
469   8255 09           	add hl,bc
470   8256
471   8256 01 FF 03     	ld bc,#03ff
472   8259              format_name_cl2
473   8259 7E           	ld a,(hl)
474   825A FE 21        	cp " "+1
475   825C 38 04        	jr c,format_name_skip2
476   825E ED A0        	ldi
477   8260 10 F7        	djnz format_name_cl2
478   8262              format_name_skip2
479   8262 C9           	ret
480   8263
481   8263              print_rect_r ;печать рамки правой
482   8263 3E 0F        	ld a,color_backgr ;цвет
483   8265 06 0C        	ld b,#c
484   8267              	OS_SET_COLOR
484   8267 0E 06       >    ld c,#06
484   8269 E7          >    rst #20
485   826A 11 28 00     	ld de,#0028 ;xy
486   826D              	OS_SET_XY
486   826D 0E 01       >    ld c,#01
486   826F E7          >    rst #20
487   8270 21 AA 87     	ld hl,rect_1
488   8273              	OS_PRINTZ
488   8273 0E 09       >    ld c,#09
488   8275 E7          >    rst #20
489   8276
490   8276 11 28 01     	ld de,#0128 ;xy
491   8279 06 16        	ld b,24-2 ;цикл
492   827B              print_rect_r_cl
493   827B C5           	push bc
494   827C D5           	push de
495   827D              	OS_SET_XY
495   827D 0E 01       >    ld c,#01
495   827F E7          >    rst #20
496   8280 21 D3 87     	ld hl,rect_2
497   8283              	OS_PRINTZ
497   8283 0E 09       >    ld c,#09
497   8285 E7          >    rst #20
498   8286 D1           	pop de
499   8287 14           	inc d
500   8288 C1           	pop bc
501   8289 10 F0        	djnz print_rect_r_cl
502   828B
503   828B
504   828B 11 28 17     	ld de,#1728 ;xy
505   828E              	OS_SET_XY
505   828E 0E 01       >    ld c,#01
505   8290 E7          >    rst #20
506   8291 21 FC 87     	ld hl,rect_3
507   8294              	OS_PRINTZ
507   8294 0E 09       >    ld c,#09
507   8296 E7          >    rst #20
508   8297 C9           	ret
509   8298
510   8298              print_menu_main ;печать основного меню
511   8298 3E 28        	ld a,color_backgr_hi ;цвет
512   829A 06 0C        	ld b,#c
513   829C              	OS_SET_COLOR
513   829C 0E 06       >    ld c,#06
513   829E E7          >    rst #20
514   829F 11 18 18     	ld de,#1800+3*8
515   82A2              	OS_SET_XY
515   82A2 0E 01       >    ld c,#01
515   82A4 E7          >    rst #20
516   82A5 21 25 88     	ld hl,msg_menu_main
517   82A8              	OS_PRINTZ
517   82A8 0E 09       >    ld c,#09
517   82AA E7          >    rst #20
518   82AB C9           	ret
519   82AC
520   82AC
521   82AC              	include nc_view.asm ;просмотрщик
# file opened: nc_view.asm
  1+  82AC              view_file
  2+  82AC              	;просмотр файла как текста
  3+  82AC
  4+  82AC 2A 87 85     	ld hl,(file_r_all)
  5+  82AF 7D           	ld a,l
  6+  82B0 B4           	or h
  7+  82B1 CA 7B 83     	jp z,view_file_ex ;защита
  8+  82B4 CD CC 80     	call calc_deskr
  9+  82B7 DD 7E 0B     	ld a,(ix+#0b)
 10+  82BA FE 10        	cp #10 ;признак каталога
 11+  82BC CA 7B 83     	jp z,view_file_ex
 12+  82BF
 13+  82BF CD 2E 82     	call format_name ;обработать имя файла
 14+  82C2
 15+  82C2
 16+  82C2
 17+  82C2              	OS_CLS ;почистить экран
 17+  82C2 0E 00       >    ld c,#00
 17+  82C4 E7          >    rst #20
 18+  82C5
 19+  82C5              	;обнулить переменные
 20+  82C5 AF           	xor a
 21+  82C6 32 84 85     	ld (view_file_load_all),a ;флаг что файл весь прочитан
 22+  82C9              	;ld (view_file_bot_flag),a  ;
 23+  82C9 21 FF FF     	ld hl,#ffff
 24+  82CC 22 85 85     	ld (view_file_end),hl ;конец файла тут
 25+  82CF 23           	inc hl
 26+  82D0 22 7C 85     	ld (view_move_right_val),hl
 27+  82D3
 28+  82D3 C5           	push bc
 29+  82D4 CD 7C 80     	call clear_buf
 30+  82D7 C1           	pop bc
 31+  82D8
 32+  82D8 21 89 85     	ld hl,file_name_cur		;строка с именем
 33+  82DB              	OS_FILE_OPEN
 33+  82DB 0E 21       >    ld c,#21
 33+  82DD E7          >    rst #20
 34+  82DE 30 0E        	jr nc,view_file_open_ok
 35+  82E0              view_file_file_error
 36+  82E0 21 2C 88     	ld hl,msg_file_error
 37+  82E3              	OS_PRINTZ
 37+  82E3 0E 09       >    ld c,#09
 37+  82E5 E7          >    rst #20
 38+  82E6 06 64        	ld b,2*50
 39+  82E8 CD 78 80     	call delay1
 40+  82EB C3 75 83     	jp view_file_wait_ex
 41+  82EE
 42+  82EE              view_file_open_ok
 43+  82EE 32 A6 87     	ld (file_id_cur_r),a
 44+  82F1              	;проверка длины файла не больше #4000
 45+  82F1 7A           	ld	a,d ;самые старшие байты длины
 46+  82F2 B3           	or e
 47+  82F3 28 11        	jr z,view_file_size_ok ;если не слищком большой
 48+  82F5              view_file_too_big
 49+  82F5              	;файл больше буфера
 50+  82F5 11 00 40     	ld de,#4000 ;размер одной первой части
 51+  82F8 21 00 C0     	ld hl,buffer_cat
 52+  82FB 3A A6 87     	ld a,(file_id_cur_r)
 53+  82FE              	OS_FILE_READ ;загрузить
 53+  82FE 0E 23       >    ld c,#23
 53+  8300 E7          >    rst #20
 54+  8301 38 DD        	jr c,view_file_file_error
 55+  8303
 56+  8303 C3 2F 83     	jp view_file_readed
 57+  8306
 58+  8306              view_file_size_ok
 59+  8306 78           	ld	a,b ;младший старший байт длины
 60+  8307 FE 40        	cp #40
 61+  8309 38 06        	jr c,view_file_size_ok_small
 62+  830B 20 E8        	jr nz,view_file_too_big
 63+  830D 0C           	inc c
 64+  830E 0D           	dec c
 65+  830F 20 E4        	jr nz,view_file_too_big
 66+  8311
 67+  8311
 68+  8311              view_file_size_ok_small
 69+  8311              	;проверка на 0
 70+  8311 78           	ld a,b
 71+  8312 B1           	or c
 72+  8313 CA E0 82     	jp z,view_file_file_error
 73+  8316              	;узнать где конец файла
 74+  8316 21 00 C0     	ld hl,buffer_cat
 75+  8319 09           	add hl,bc
 76+  831A 22 85 85     	ld (view_file_end),hl ;конец файла тут
 77+  831D              	;размер не большой, прочитаем
 78+  831D 50           	ld d,b ;размер
 79+  831E 59           	ld e,c
 80+  831F 21 00 C0     	ld hl,buffer_cat
 81+  8322 3A A6 87     	ld a,(file_id_cur_r)
 82+  8325              	OS_FILE_READ ;загрузить
 82+  8325 0E 23       >    ld c,#23
 82+  8327 E7          >    rst #20
 83+  8328 38 B6        	jr c,view_file_file_error
 84+  832A
 85+  832A 3E 01        	ld a,1
 86+  832C 32 84 85     	ld (view_file_load_all),a ;флаг что файл весь прочитан
 87+  832F
 88+  832F              view_file_readed
 89+  832F              	;файл прочитан
 90+  832F
 91+  832F 21 00 C0     	ld hl,buffer_cat
 92+  8332 22 7E 85     	ld (view_file_pos_cur),hl ;позиция просмотра на начало
 93+  8335 22 80 85     	ld (view_file_pos_cur_focus),hl ;позиция фокуса
 94+  8338
 95+  8338 CD 3A 84     	call print_file_text
 96+  833B
 97+  833B
 98+  833B CD 05 84     	call print_menu_view ;меню
 99+  833E CD 20 84     	call print_menu_view_top ;инфо
100+  8341
101+  8341 CD 8A 80     	call release_key
102+  8344
103+  8344              view_file_wait ;цикл ожидания клавиши
104+  8344              	OS_WAIT
104+  8344 DF          >	rst #18
105+  8345              	OS_GET_CHAR
105+  8345 0E 10       >    ld c,#10
105+  8347 E7          >    rst #20
106+  8348 FE FF        	cp 255
107+  834A 28 F8        	jr z,view_file_wait
108+  834C FE 33        	cp "3"
109+  834E 28 25        	jr z,view_file_wait_ex
110+  8350 FE 0A        	cp 10 ;вниз
111+  8352 CA 7E 83     	jp z,view_line_down
112+  8355 FE 0B        	cp 11 ;вверх
113+  8357 CA 94 83     	jp z,view_line_up
114+  835A FE 09        	cp 09 ;вправо
115+  835C CA AA 83     	jp z,view_right
116+  835F FE 08        	cp 08 ;влево
117+  8361 CA BA 83     	jp z,view_left
118+  8364 FE 04        	cp 04 ;вправо
119+  8366 CA CB 83     	jp z,view_page_up
120+  8369 FE 05        	cp 05 ;влево
121+  836B CA E8 83     	jp z,view_page_down
122+  836E FE 18        	cp 24 ;break
123+  8370 CA 18 81     	jp z,exit
124+  8373 18 CF        	jr view_file_wait
125+  8375
126+  8375              view_file_wait_ex
127+  8375              	;почистить экран
128+  8375              	OS_CLS
128+  8375 0E 00       >    ld c,#00
128+  8377 E7          >    rst #20
129+  8378 C3 23 80     	jp start_nc_warm ;перезагрузить папку
130+  837B
131+  837B              view_file_ex
132+  837B C3 53 80     	jp nc_wait
133+  837E
134+  837E
135+  837E
136+  837E              view_line_down ;вниз на строчку
137+  837E 2A 80 85     	ld hl,(view_file_pos_cur_focus) ;фокус
138+  8381 22 7E 85     	ld (view_file_pos_cur),hl
139+  8384 CD 4F 85     	call next_line ;вперёд на строку
140+  8387 38 BB        	jr c,view_file_wait ;если не удачно
141+  8389 2A 7E 85     	ld hl,(view_file_pos_cur) ;запомнить фокус
142+  838C 22 80 85     	ld (view_file_pos_cur_focus),hl
143+  838F CD 3A 84     	call print_file_text ;напечатать всю страницу
144+  8392 18 B0        	jr view_file_wait
145+  8394
146+  8394              view_line_up ;вверх на строчку
147+  8394 2A 80 85     	ld hl,(view_file_pos_cur_focus) ;фокус
148+  8397 22 7E 85     	ld (view_file_pos_cur),hl
149+  839A CD 5D 85     	call prev_line ;
150+  839D 38 A5        	jr c,view_file_wait ;если не удачно
151+  839F 2A 7E 85     	ld hl,(view_file_pos_cur) ;запомнить фокус
152+  83A2 22 80 85     	ld (view_file_pos_cur_focus),hl
153+  83A5 CD 3A 84     	call print_file_text ;напечатать всю страницу
154+  83A8 18 9A        	jr view_file_wait
155+  83AA
156+  83AA
157+  83AA              view_right ;вправо
158+  83AA 2A 7C 85     	ld hl,(view_move_right_val)
159+  83AD 23           	inc hl
160+  83AE 7C           	ld a,h
161+  83AF B5           	or l
162+  83B0 28 92        	jr z,view_file_wait
163+  83B2 22 7C 85     	ld (view_move_right_val),hl
164+  83B5 CD 3A 84     	call print_file_text ;напечатать всю страницу
165+  83B8 18 8A        	jr view_file_wait
166+  83BA
167+  83BA              view_left ;влево
168+  83BA 2A 7C 85     	ld hl,(view_move_right_val)
169+  83BD 7C           	ld a,h
170+  83BE B5           	or l
171+  83BF 28 83        	jr z,view_file_wait
172+  83C1 2B           	dec hl
173+  83C2 22 7C 85     	ld (view_move_right_val),hl
174+  83C5 CD 3A 84     	call print_file_text ;напечатать всю страницу
175+  83C8 C3 44 83     	jp view_file_wait
176+  83CB
177+  83CB
178+  83CB
179+  83CB              view_page_up ;на страницу назад
180+  83CB 2A 80 85     	ld hl,(view_file_pos_cur_focus) ;фокус
181+  83CE 22 7E 85     	ld (view_file_pos_cur),hl
182+  83D1 06 16        	ld b,view_text_bot-2
183+  83D3              view_page_up_cl
184+  83D3 CD 5D 85     	call prev_line ;
185+  83D6 38 04        	jr c,view_page_up_ex ;если не удачно
186+  83D8 28 02        	jr z,view_page_up_ex
187+  83DA 10 F7        	djnz view_page_up_cl
188+  83DC              view_page_up_ex
189+  83DC 2A 7E 85     	ld hl,(view_file_pos_cur) ;запомнить фокус
190+  83DF 22 80 85     	ld (view_file_pos_cur_focus),hl
191+  83E2 CD 3A 84     	call print_file_text ;напечатать всю страницу
192+  83E5 C3 44 83     	jp view_file_wait
193+  83E8
194+  83E8
195+  83E8
196+  83E8              view_page_down ;на страницу вперёд
197+  83E8 2A 80 85     	ld hl,(view_file_pos_cur_focus) ;фокус
198+  83EB 22 7E 85     	ld (view_file_pos_cur),hl
199+  83EE 06 16        	ld b,view_text_bot-2
200+  83F0              view_page_down_cl
201+  83F0 CD 4F 85     	call next_line ;
202+  83F3 38 04        	jr c,view_page_down_ex ;если не удачно
203+  83F5 28 02        	jr z,view_page_down_ex
204+  83F7 10 F7        	djnz view_page_down_cl
205+  83F9              view_page_down_ex
206+  83F9 2A 7E 85     	ld hl,(view_file_pos_cur) ;запомнить фокус
207+  83FC 22 80 85     	ld (view_file_pos_cur_focus),hl
208+  83FF CD 3A 84     	call print_file_text ;напечатать всю страницу
209+  8402 C3 44 83     	jp view_file_wait
210+  8405
211+  8405
212+  8405
213+  8405              print_menu_view ;печать меню просмотрщика
214+  8405 3E 18        	ld a,#18
215+  8407 06 28        	ld b,color_backgr_hi ;цвет
216+  8409              	OS_PAINT_LINE ;линия внизу
216+  8409 0E 04       >    ld c,#04
216+  840B E7          >    rst #20
217+  840C 3E 28        	ld a,color_backgr_hi ;цвет
218+  840E 06 0C        	ld b,#c
219+  8410              	OS_SET_COLOR
219+  8410 0E 06       >    ld c,#06
219+  8412 E7          >    rst #20
220+  8413 11 18 18     	ld de,#1800+3*8
221+  8416              	OS_SET_XY
221+  8416 0E 01       >    ld c,#01
221+  8418 E7          >    rst #20
222+  8419 21 75 85     	ld hl,msg_menu_view
223+  841C              	OS_PRINTZ
223+  841C 0E 09       >    ld c,#09
223+  841E E7          >    rst #20
224+  841F C9           	ret
225+  8420
226+  8420              print_menu_view_top ;печать меню просмотрщика верхнее
227+  8420 AF           	xor a
228+  8421 06 28        	ld b,color_backgr_hi ;цвет
229+  8423              	OS_PAINT_LINE ;линия вверху
229+  8423 0E 04       >    ld c,#04
229+  8425 E7          >    rst #20
230+  8426 3E 28        	ld a,color_backgr_hi ;цвет
231+  8428 06 0C        	ld b,#c
232+  842A              	OS_SET_COLOR
232+  842A 0E 06       >    ld c,#06
232+  842C E7          >    rst #20
233+  842D 11 24 00     	ld de,#0024
234+  8430              	OS_SET_XY
234+  8430 0E 01       >    ld c,#01
234+  8432 E7          >    rst #20
235+  8433 21 89 85     	ld hl,file_name_cur
236+  8436              	OS_PRINTZ
236+  8436 0E 09       >    ld c,#09
236+  8438 E7          >    rst #20
237+  8439 C9           	ret
238+  843A
239+  843A
240+  843A
241+  843A              print_file_text	;печать текущей части файла в консоль
242+  843A 3E 04        	ld a,4 ;цвет
243+  843C 06 0C        	ld b,#c
244+  843E              	OS_SET_COLOR
244+  843E 0E 06       >    ld c,#06
244+  8440 E7          >    rst #20
245+  8441
246+  8441 3E 01        	ld a,view_text_top ;первая строка
247+  8443 32 82 85     	ld (view_file_y_cur),a
248+  8446 2A 80 85     	ld hl,(view_file_pos_cur_focus) ;печать видимой части
249+  8449 22 7E 85     	ld (view_file_pos_cur),hl
250+  844C              print_file_text_cl
251+  844C 2A 7E 85     	ld hl,(view_file_pos_cur)
252+  844F CD 75 84     	call print_line_text
253+  8452 38 0C        	jr c,print_file_text_ex
254+  8454
255+  8454              	; call next_line ;найти следующую строку
256+  8454              	; ret c
257+  8454
258+  8454 3A 82 85     	ld a,(view_file_y_cur)
259+  8457 3C           	inc a
260+  8458 32 82 85     	ld (view_file_y_cur),a
261+  845B FE 18        	cp view_text_bot
262+  845D 38 ED        	jr c,print_file_text_cl
263+  845F C9           	ret
264+  8460
265+  8460              print_file_text_ex
266+  8460              	;тут очистить остальные строки
267+  8460 3A 82 85     	ld a,(view_file_y_cur)
268+  8463 FE 18        	cp view_text_bot
269+  8465 30 0C        	jr nc,print_file_text_ex2
270+  8467 67           	ld h,a
271+  8468 3C           	inc a
272+  8469 32 82 85     	ld (view_file_y_cur),a
273+  846C 3E 20        	ld a," "
274+  846E              	OS_FILL_LINE ;очистить строку
274+  846E 0E 03       >    ld c,#03
274+  8470 E7          >    rst #20
275+  8471 18 ED        	jr print_file_text_ex
276+  8473              print_file_text_ex2
277+  8473 37           	scf
278+  8474 C9           	ret
279+  8475
280+  8475
281+  8475
282+  8475              print_line_text ;печать одной строки до кода 13, или до правого края экрана, или до конца файла
283+  8475              ;вх: hl - адрес строки
284+  8475 CD B9 84     	call view_move_right ;промотать направо. если надо
285+  8478              	;установить позицию
286+  8478 3A 82 85     	ld a,(view_file_y_cur)
287+  847B 57           	ld d,a
288+  847C AF           	xor a
289+  847D 32 83 85     	ld (view_file_x_cur),a
290+  8480 5F           	ld e,a
291+  8481              	OS_SET_XY 	;yx
291+  8481 0E 01       >    ld c,#01
291+  8483 E7          >    rst #20
292+  8484              print_line_text_cl ;цикл
293+  8484
294+  8484 7E           	ld a,(hl)
295+  8485 FE 0A        	cp 10 ;этот код не печатаем
296+  8487 28 14        	jr z,print_line_text_skip
297+  8489 FE FF        	cp #ff ;этот код не печатаем
298+  848B 28 10        	jr z,print_line_text_skip
299+  848D FE 0D        	cp 13
300+  848F 28 12        	jr z,print_line_text_ex_ok
301+  8491              	OS_PRINT_CHARF ;печать
301+  8491 D7          >	rst #10
302+  8492
303+  8492              	;на следующую позицию
304+  8492 3A 83 85     	ld a,(view_file_x_cur)
305+  8495 3C           	inc a
306+  8496 FE 50        	cp 80 ;правый край экрана
307+  8498 32 83 85     	ld (view_file_x_cur),a
308+  849B 30 18        	jr nc,print_line_text_right ;дошли до правого края
309+  849D
310+  849D              print_line_text_skip
311+  849D CD F1 84     	call view_file_next_pos ;следующий
312+  84A0 30 E2        	jr nc,print_line_text_cl ;на следующий символ
313+  84A2 C9           	ret
314+  84A3
315+  84A3
316+  84A3              print_line_text_ex_ok ;выход норма
317+  84A3              	;тут надо добить строку пробелами
318+  84A3 3E 20        	ld a," "
319+  84A5              	OS_PRINT_CHARF ;печать
319+  84A5 D7          >	rst #10
320+  84A6 3A 83 85     	ld a,(view_file_x_cur)
321+  84A9 3C           	inc a
322+  84AA FE 50        	cp 80 ;правый край экрана
323+  84AC 32 83 85     	ld (view_file_x_cur),a
324+  84AF 38 F2        	jr c,print_line_text_ex_ok
325+  84B1
326+  84B1
327+  84B1 CD F1 84     	call view_file_next_pos ;следующий
328+  84B4
329+  84B4 C9           	ret
330+  84B5              ; print_line_text_ex_end ;выход если кончился файл
331+  84B5              	; scf
332+  84B5              	; ret
333+  84B5
334+  84B5              print_line_text_right
335+  84B5 CD 4F 85     	call next_line ;позицию  до конца строки
336+  84B8 C9           	ret
337+  84B9
338+  84B9
339+  84B9
340+  84B9              view_move_right ;перемотка строки направо
341+  84B9 ED 4B 7C 85  	ld bc,(view_move_right_val) ;на сколько символов вправо промотать
342+  84BD 78           	ld a,b
343+  84BE B1           	or c
344+  84BF C8           	ret z
345+  84C0 2A 7E 85     	ld hl,(view_file_pos_cur)
346+  84C3              view_move_right1
347+  84C3 7E           	ld a,(hl)
348+  84C4 FE 0A        	cp 10 ;этот код пропускаем
349+  84C6 20 07        	jr nz,view_move_right2
350+  84C8 CD F1 84     	call view_file_next_pos
351+  84CB D8           	ret c
352+  84CC C8           	ret z
353+  84CD 18 F4        	jr view_move_right1
354+  84CF              view_move_right2
355+  84CF FE FF        	cp #ff ;этот код пропускаем
356+  84D1 20 07        	jr nz,view_move_right3
357+  84D3 CD F1 84     	call view_file_next_pos
358+  84D6 D8           	ret c
359+  84D7 C8           	ret z
360+  84D8 18 E9        	jr view_move_right1
361+  84DA              view_move_right3
362+  84DA 7E           	ld a,(hl)
363+  84DB FE 0D        	cp 13 ;
364+  84DD C8           	ret z
365+  84DE              view_move_right_cl
366+  84DE CD F1 84     	call view_file_next_pos
367+  84E1 D8           	ret c
368+  84E2 C8           	ret z
369+  84E3 7E           	ld a,(hl)
370+  84E4 FE 0D        	cp 13
371+  84E6 C8           	ret z
372+  84E7 FE 0A        	cp 10 ;этот код пропускаем
373+  84E9 28 F3        	jr z,view_move_right_cl
374+  84EB 0B           	dec bc
375+  84EC 78           	ld a,b
376+  84ED B1           	or c
377+  84EE 20 EE        	jr nz,view_move_right_cl
378+  84F0              	;call view_file_next_pos ;следующий
379+  84F0 C9           	ret
380+  84F1
381+  84F1
382+  84F1
383+  84F1              ;получение следующей позиции
384+  84F1              view_file_next_pos
385+  84F1 3A 84 85     	ld a,(view_file_load_all) ;флаг что файл весь в памяти
386+  84F4 B7           	or a
387+  84F5 28 14        	jr z,view_file_next_pos_big
388+  84F7              	;если текст не большой
389+  84F7 2A 85 85     	ld hl,(view_file_end) ;конец текста известен
390+  84FA ED 5B 7E 85  	ld de,(view_file_pos_cur)
391+  84FE 13           	inc de ;вперёд
392+  84FF A7           	and a
393+  8500 ED 52        	sbc hl,de
394+  8502 38 15        	jr c,view_file_next_pos_end
395+  8504 ED 53 7E 85  	ld (view_file_pos_cur),de
396+  8508 EB           	ex de,hl ;на выходе адрес в HL
397+  8509 B7           	or a
398+  850A C9           	ret
399+  850B
400+  850B
401+  850B
402+  850B              view_file_next_pos_big
403+  850B              	;если текст большой
404+  850B 2A 7E 85     	ld hl,(view_file_pos_cur)	;текущая позиция
405+  850E 23           	inc hl ;вперёд
406+  850F 7C           	ld a,h
407+  8510 FE C0        	cp #c0 ;если вышли за пределы окна
408+  8512 38 05        	jr c,view_file_next_pos_end
409+  8514 22 7E 85     	ld (view_file_pos_cur),hl
410+  8517 B7           	or a
411+  8518 C9           	ret
412+  8519
413+  8519              view_file_next_pos_end
414+  8519              	;не смогли шагнуть вперёд
415+  8519              	; ld a,1 ;флаг что внизу
416+  8519              	; ld (view_file_bot_flag),a
417+  8519 37           	scf ;ошибка
418+  851A C9           	ret
419+  851B
420+  851B
421+  851B
422+  851B
423+  851B
424+  851B
425+  851B              ;получение предыдущей позиции
426+  851B              view_file_prev_pos
427+  851B 3A 84 85     	ld a,(view_file_load_all) ;флаг что файл весь в памяти
428+  851E B7           	or a
429+  851F 28 1E        	jr z,view_file_prev_pos_big
430+  8521              	;если текст не большой
431+  8521 21 00 C0     	ld hl,buffer_cat ;тут лежит текст
432+  8524 ED 5B 7E 85  	ld de,(view_file_pos_cur) ;текущая позиция
433+  8528 1B           	dec de ;назад
434+  8529 A7           	and a
435+  852A ED 52        	sbc hl,de
436+  852C 28 0A        	jr z,view_file_prev_pos_top ;если пришли в начало
437+  852E 30 1D        	jr nc,view_file_prev_pos_end
438+  8530              	;можно шагнуть назад
439+  8530 ED 53 7E 85  	ld (view_file_pos_cur),de
440+  8534 EB           	ex de,hl ;на выходе адрес в HL
441+  8535 AF           	xor a
442+  8536 3C           	inc a ;a=1
443+  8537 C9           	ret
444+  8538              view_file_prev_pos_top
445+  8538              	;если в начале
446+  8538 ED 53 7E 85  	ld (view_file_pos_cur),de
447+  853C EB           	ex de,hl ;на выходе адрес в HL
448+  853D AF           	xor a ;a=0
449+  853E C9           	ret
450+  853F
451+  853F
452+  853F              view_file_prev_pos_big
453+  853F              	;если текст большой
454+  853F 2A 7E 85     	ld hl,(view_file_pos_cur)	;текущая позиция
455+  8542 2B           	dec hl ;назад
456+  8543 7C           	ld a,h
457+  8544 FE C0        	cp #c0 ;если вышли за пределы окна
458+  8546 38 05        	jr c,view_file_prev_pos_end
459+  8548 22 7E 85     	ld (view_file_pos_cur),hl
460+  854B B7           	or a
461+  854C C9           	ret
462+  854D
463+  854D              view_file_prev_pos_end
464+  854D              	;не смогли шагнуть назад
465+  854D              	; ld hl,buffer_cat ;тут лежит текст
466+  854D              	; ld (view_file_pos_cur),hl ;текущая позиция в самом начале
467+  854D 37           	scf ;ошибка
468+  854E C9           	ret
469+  854F
470+  854F
471+  854F
472+  854F
473+  854F              next_line ;поиск следующей строки
474+  854F CD F1 84     	call view_file_next_pos
475+  8552 D8           	ret c
476+  8553 C8           	ret z
477+  8554 7E           	ld a,(hl)
478+  8555 FE 0D        	cp 13
479+  8557 20 F6        	jr nz,next_line
480+  8559 CD F1 84     	call view_file_next_pos ;ещё на символ
481+  855C C9           	ret
482+  855D
483+  855D
484+  855D
485+  855D              prev_line ;поиск предыдущей строки
486+  855D              	;сначала в конец предыдущей
487+  855D CD 1B 85     	call view_file_prev_pos
488+  8560 C8           	ret z
489+  8561 D8           	ret c
490+  8562 7E           	ld a,(hl)
491+  8563 FE 0D        	cp 13
492+  8565 20 F6        	jr nz,prev_line
493+  8567              	;теперь в начало предыдущей
494+  8567              prev_line1
495+  8567 CD 1B 85     	call view_file_prev_pos
496+  856A C8           	ret z
497+  856B D8           	ret c
498+  856C 7E           	ld a,(hl)
499+  856D FE 0D        	cp 13
500+  856F 20 F6        	jr nz,prev_line1
501+  8571 CD F1 84     	call view_file_next_pos ;ещё на символ обратно
502+  8574 C9           	ret
503+  8575
504+  8575
505+  8575
506+  8575              view_text_bot equ 24 ;последняя строка для печати
507+  8575              view_text_top equ 1 ;первая строка
508+  8575              view_text_lines equ 25-2 ;видимых строк на экране
509+  8575
510+  8575              msg_menu_view
511+  8575 33 20 45 78  	db "3 Exit",0
511+  8579 69 74 00
512+  857C
513+  857C              ;view_file_position ds 4 ;текущая позиция в файле
514+  857C              ;view_file_bot_flag db 0 ;флаг что домотали вниз до конца
515+  857C 00 00        view_move_right_val dw 0 ;сдвиг вправо
516+  857E 00 00        view_file_pos_cur dw 0;текущая позиция
517+  8580 00 00        view_file_pos_cur_focus dw 0 ;позиция фокуса
518+  8582 00           view_file_y_cur db 0;текущая строка
519+  8583 00           view_file_x_cur db 0;текущий столбец
520+  8584 00           view_file_load_all db 0 ;флаг что файл весь загружен
521+  8585 00 00        view_file_end dw 0 ;конец файлв, или текущего куска
522+  8587
523+  8587
# file closed: nc_view.asm
522   8587
523   8587
524   8587              color_backgr equ 1*8+7 ;цвет фона
525   8587              color_apg equ 1*8+4 ;цвет приложений
526   8587              color_dir equ 1*8+6 ;цвет папок
527   8587
528   8587              color_backgr_hi equ 5*8+0 ;цвет фона курсор
529   8587              color_apg_hi equ 5*8+0 ;цвет приложений курсор
530   8587              color_dir_hi equ 5*8+0 ;цвет папок курсор
531   8587
532   8587              file_info_lenght equ 11 ;длина инфо о файле
533   8587              panel_hight equ 22;высота панели
534   8587              panel_r_xy equ #0129
535   8587              buffer_cat equ #c000 ;адрес буфера каталога
536   8587
537   8587 00 00        file_r_all dw 0;всего файлов справа
538   8589 00 00 00...  file_name_cur ds 256 ;имя файла текущее
539   8689 00 00 00...  dir_name_cur ds 256 ;имя файла текущее
540   8789 00 00 00...  file_info_string ds file_info_lenght+1 ;буфер инфо
541   8795 20 20 20 20  file_info_clear db "            ",0 ;для очистки
541   8799 20 20 20 20
541   879D 20 20 20 20
541   87A1 00
542   87A2 00           buffer_cat_page_r db 0 ;страница буфера каталога правый
543   87A3
544   87A3 00 00        file_r_num_cur dw 0 ;текущий файл справа
545   87A5 00           key_pressed db 0 ;последняя клавиша
546   87A6 00           file_id_cur_r db 0 ;id файла справа
547   87A7
548   87A7
549   87A7 00           page_ext01 db 0 ;номер дополнительной страницы
550   87A8 00 00        page_main dw 0 ;основные номера страниц слота 2,3
551   87AA
552   87AA              rect_1
553   87AA C9           	db #c9
554   87AB              	dup 40-2
555   87AB CD          >	db #cd
555   87AC CD          >	db #cd
555   87AD CD          >	db #cd
555   87AE CD          >	db #cd
555   87AF CD          >	db #cd
555   87B0 CD          >	db #cd
555   87B1 CD          >	db #cd
555   87B2 CD          >	db #cd
555   87B3 CD          >	db #cd
555   87B4 CD          >	db #cd
555   87B5 CD          >	db #cd
555   87B6 CD          >	db #cd
555   87B7 CD          >	db #cd
555   87B8 CD          >	db #cd
555   87B9 CD          >	db #cd
555   87BA CD          >	db #cd
555   87BB CD          >	db #cd
555   87BC CD          >	db #cd
555   87BD CD          >	db #cd
555   87BE CD          >	db #cd
555   87BF CD          >	db #cd
555   87C0 CD          >	db #cd
555   87C1 CD          >	db #cd
555   87C2 CD          >	db #cd
555   87C3 CD          >	db #cd
555   87C4 CD          >	db #cd
555   87C5 CD          >	db #cd
555   87C6 CD          >	db #cd
555   87C7 CD          >	db #cd
555   87C8 CD          >	db #cd
555   87C9 CD          >	db #cd
555   87CA CD          >	db #cd
555   87CB CD          >	db #cd
555   87CC CD          >	db #cd
555   87CD CD          >	db #cd
555   87CE CD          >	db #cd
555   87CF CD          >	db #cd
555   87D0 CD          >	db #cd
556   87D1              	edup
557   87D1 BB 00        	db #bb,0
558   87D3
559   87D3              rect_2
560   87D3 BA           	db #ba
561   87D4              	dup 40-2
562   87D4 20          >	db " "
562   87D5 20          >	db " "
562   87D6 20          >	db " "
562   87D7 20          >	db " "
562   87D8 20          >	db " "
562   87D9 20          >	db " "
562   87DA 20          >	db " "
562   87DB 20          >	db " "
562   87DC 20          >	db " "
562   87DD 20          >	db " "
562   87DE 20          >	db " "
562   87DF 20          >	db " "
562   87E0 20          >	db " "
562   87E1 20          >	db " "
562   87E2 20          >	db " "
562   87E3 20          >	db " "
562   87E4 20          >	db " "
562   87E5 20          >	db " "
562   87E6 20          >	db " "
562   87E7 20          >	db " "
562   87E8 20          >	db " "
562   87E9 20          >	db " "
562   87EA 20          >	db " "
562   87EB 20          >	db " "
562   87EC 20          >	db " "
562   87ED 20          >	db " "
562   87EE 20          >	db " "
562   87EF 20          >	db " "
562   87F0 20          >	db " "
562   87F1 20          >	db " "
562   87F2 20          >	db " "
562   87F3 20          >	db " "
562   87F4 20          >	db " "
562   87F5 20          >	db " "
562   87F6 20          >	db " "
562   87F7 20          >	db " "
562   87F8 20          >	db " "
562   87F9 20          >	db " "
563   87FA              	edup
564   87FA BA 00        	db #ba,0
565   87FC
566   87FC              rect_3
567   87FC C8           	db #c8
568   87FD              	dup 40-2
569   87FD CD          >	db #cd
569   87FE CD          >	db #cd
569   87FF CD          >	db #cd
569   8800 CD          >	db #cd
569   8801 CD          >	db #cd
569   8802 CD          >	db #cd
569   8803 CD          >	db #cd
569   8804 CD          >	db #cd
569   8805 CD          >	db #cd
569   8806 CD          >	db #cd
569   8807 CD          >	db #cd
569   8808 CD          >	db #cd
569   8809 CD          >	db #cd
569   880A CD          >	db #cd
569   880B CD          >	db #cd
569   880C CD          >	db #cd
569   880D CD          >	db #cd
569   880E CD          >	db #cd
569   880F CD          >	db #cd
569   8810 CD          >	db #cd
569   8811 CD          >	db #cd
569   8812 CD          >	db #cd
569   8813 CD          >	db #cd
569   8814 CD          >	db #cd
569   8815 CD          >	db #cd
569   8816 CD          >	db #cd
569   8817 CD          >	db #cd
569   8818 CD          >	db #cd
569   8819 CD          >	db #cd
569   881A CD          >	db #cd
569   881B CD          >	db #cd
569   881C CD          >	db #cd
569   881D CD          >	db #cd
569   881E CD          >	db #cd
569   881F CD          >	db #cd
569   8820 CD          >	db #cd
569   8821 CD          >	db #cd
569   8822 CD          >	db #cd
570   8823              	edup
571   8823 BC 00        	db #bc,0
572   8825
573   8825              msg_menu_main
574   8825 33 20 56 69  	db "3 View",0
574   8829 65 77 00
575   882C              msg_file_error
576   882C 46 69 6C 65  	db "File error",10,13,0
576   8830 20 65 72 72
576   8834 6F 72 0A 0D
576   8838 00
577   8839              msg_file_too_big
578   8839 46 69 6C 65  	db "File too big",10,13,0
578   883D 20 74 6F 6F
578   8841 20 62 69 67
578   8845 0A 0D 00
579   8848              msg_mem_err
580   8848 47 65 74 20  	db "Get memory error",10,13,0
580   884C 6D 65 6D 6F
580   8850 72 79 20 65
580   8854 72 72 6F 72
580   8858 0A 0D 00
581   885B              msg_title_nc
582   885B 4E 6F 6E 65  	db "None Commander ver 2025.06.17",10,13,0
582   885F 20 43 6F 6D
582   8863 6D 61 6E 64
582   8867 65 72 20 76
582   886B 65 72 20 32
582   886F 30 32 35 2E
582   8873 30 36 2E 31
582   8877 37 0A 0D 00
583   887B
584   887B              end_nc
585   887B              	savebin "nc.apg",start_nc,$-start_nc
# file closed: nc.asm
